# 🎨 GeoLens - 前端技术策略决策文档

## 📅 决策时间
**决策日期**: 2024-12-19  
**决策版本**: v1.0  
**决策状态**: ✅ **已确认 - Streamlit MVP方案**  
**参与者**: 产品负责人 + 技术负责人  

---

## 🎯 核心决策：选择 Streamlit 作为 MVP 前端

### ✅ **最终决策**
**采用 Streamlit 构建 MVP 前端，替代原计划的 React + TypeScript 方案**

### 🤔 **决策背景**
- 项目处于 MVP 阶段，需要快速验证产品价值
- 后端 FastAPI + Python 技术栈已完成并验证（v0.7.0，82.4%测试通过率）
- 核心价值在于 AI 引用检测算法，而非前端交互体验
- 团队资源有限，需要最大化开发效率

---

## 📊 技术方案对比分析

### **Streamlit vs React 对比**

| 维度 | Streamlit | React + TypeScript | 决策权重 | 胜出方 |
|------|-----------|-------------------|----------|--------|
| **开发速度** | 1-2周完成MVP | 4-6周完成MVP | ⭐⭐⭐⭐⭐ | Streamlit |
| **技术一致性** | Python统一栈 | 前后端分离 | ⭐⭐⭐⭐ | Streamlit |
| **学习成本** | 极低 | 中等 | ⭐⭐⭐ | Streamlit |
| **数据可视化** | 原生支持强 | 需要额外库 | ⭐⭐⭐⭐ | Streamlit |
| **用户体验** | 中等 | 优秀 | ⭐⭐ | React |
| **扩展性** | 有限制 | 无限制 | ⭐⭐ | React |
| **移动端** | 一般 | 优秀 | ⭐ | React |

**综合评分**: Streamlit 胜出（MVP阶段优势明显）

---

## 🏗️ Streamlit 架构设计

### **应用结构**
```
📦 geolens_streamlit_app/
├── 📄 main.py                 # 应用入口 + 认证
├── 📁 pages/                  # 多页面应用
│   ├── 1_🏠_Dashboard.py      # 首页概览
│   ├── 2_📁_Projects.py       # 项目管理
│   ├── 3_🔍_Detection.py      # 引用检测（核心）
│   ├── 4_📜_History.py        # 检测历史
│   ├── 5_📚_Templates.py      # Prompt模板
│   ├── 6_📊_Analytics.py      # 数据分析
│   └── 7_👤_Profile.py        # 用户信息
├── 📁 components/             # 可复用组件
│   ├── auth.py               # 认证组件
│   ├── charts.py             # 图表组件
│   ├── forms.py              # 表单组件
│   └── status.py             # 状态显示
├── 📁 services/              # API服务封装
│   ├── api_client.py         # HTTP客户端
│   ├── auth_service.py       # 认证服务
│   └── detection_service.py  # 检测服务
└── 📁 utils/                 # 工具函数
    ├── config.py             # 配置管理
    ├── cache.py              # 缓存工具
    └── helpers.py            # 辅助函数
```

### **核心页面功能设计**

#### 🔍 **引用检测页（核心功能）**
- **Prompt输入**: `st.text_area` + Markdown预览
- **品牌选择**: `st.multiselect` 动态品牌列表
- **模型选择**: `st.selectbox` 支持豆包、DeepSeek、ChatGPT
- **模板应用**: `st.selectbox` 选择Prompt模板
- **实时检测**: `st.button` + `st.progress` 进度显示
- **结果展示**: `st.json` + `st.dataframe` + 可视化图表

#### 📊 **数据分析页**
- **品牌提及率对比**: Plotly柱状图
- **置信度雷达图**: Plotly雷达图
- **时间趋势分析**: Plotly折线图
- **模型性能对比**: 响应时间 + 准确率对比

#### 📜 **检测历史页**
- **历史记录表格**: `st.dataframe` + 分页
- **筛选功能**: 项目、时间、品牌筛选
- **导出功能**: `st.download_button` CSV导出
- **详情查看**: 展开查看完整检测结果

---

## 🔧 技术实现要点

### **1. 认证集成**
```python
# 与现有FastAPI JWT认证集成
- 登录: POST /api/v1/auth/login
- 刷新: POST /api/v1/auth/refresh  
- 用户信息: GET /api/v1/auth/me
- Session State存储token
```

### **2. API调用封装**
```python
# 统一HTTP客户端
- httpx异步客户端
- 自动token刷新
- 统一错误处理
- 请求/响应日志
```

### **3. 数据可视化**
```python
# 图表库选择
- Plotly: 交互式图表
- Altair: 声明式图表  
- st.line_chart: 简单图表
- st.bar_chart: 快速柱状图
```

### **4. 性能优化**
```python
# 缓存策略
- @st.cache_data: API响应缓存
- @st.cache_resource: 资源缓存
- Session State: 状态管理
```

---

## 🎯 MVP 功能优先级

### **Phase 1: 核心功能 (Week 1)**
- [x] 项目架构搭建
- [ ] 用户认证集成
- [ ] 引用检测页面
- [ ] 基础结果展示

### **Phase 2: 数据展示 (Week 2)**  
- [ ] 检测历史页面
- [ ] 基础数据可视化
- [ ] 项目管理页面
- [ ] Prompt模板管理

### **Phase 3: 体验优化 (Week 3)**
- [ ] 高级图表和分析
- [ ] 批量检测功能
- [ ] 导出和分享功能
- [ ] 响应式布局优化

---

## ⚠️ 风险评估与应对

### **技术风险**
| 风险 | 影响 | 概率 | 应对策略 |
|------|------|------|----------|
| Streamlit性能限制 | 中 | 低 | 优化缓存，必要时迁移React |
| 用户体验不足 | 中 | 中 | 重点优化核心流程，收集用户反馈 |
| 移动端适配差 | 低 | 高 | MVP阶段可接受，后续优化 |

### **业务风险**
| 风险 | 影响 | 概率 | 应对策略 |
|------|------|------|----------|
| 用户不接受界面 | 高 | 低 | 快速迭代，及时收集反馈 |
| 功能扩展受限 | 中 | 中 | 预留React迁移方案 |

---

## 🚀 迁移策略（未来考虑）

### **何时考虑迁移到React**
- 用户量 > 1000 DAU
- 移动端需求强烈
- 复杂交互需求增加
- 团队前端能力增强

### **迁移方案**
- 保持API不变
- 逐页面迁移
- 数据结构复用
- 用户无感知切换

---

## 📈 成功指标

### **技术指标**
- 开发周期: ≤ 3周完成MVP
- 页面加载: ≤ 3秒
- API响应: ≤ 2秒
- 错误率: ≤ 1%

### **用户指标**  
- 用户完成检测率: ≥ 80%
- 用户留存率: ≥ 60%
- 功能使用率: 核心功能 ≥ 90%

---

## 📝 决策记录

### **关键决策点**
1. ✅ **技术栈选择**: Streamlit vs React → Streamlit胜出
2. ✅ **架构模式**: 多页面应用 vs 单页面 → 多页面应用
3. ✅ **认证方式**: 集成现有JWT vs 独立认证 → 集成现有JWT
4. ✅ **部署方式**: Streamlit Cloud vs 自部署 → 待定

### **未来决策点**
- [ ] 何时评估React迁移
- [ ] 移动端解决方案
- [ ] 高级功能实现方式

---

*文档版本: v1.0*  
*最后更新: 2024-12-19*  
*下次评估: 2025-01-19 (MVP完成后)*
